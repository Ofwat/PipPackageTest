name: Zizmor Check

on:
  push:
    branches:
      - '*'  # Trigger on all branches
    paths:
      - '.github/workflows/*.yml'  # Only trigger on changes to GitHub Action workflows

jobs:
  zizmor-check:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      with:
        persist-credentials: false

    - name: Set up Python
      uses: actions/setup-python@v3
      with:
        python-version: "3.12"

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install setuptools wheel twine

    - name: Install Zizmor
      run: |
        pip install zizmor  # Install Zizmor

    - name: Run Zizmor audit
      run: |
        zizmor .github/workflows/  # Run Zizmor on the workflow directory

    - name: Fail if Zizmor finds issues
      run: |
        if [ $? -ne 0 ]; then
          echo "Zizmor found issues! Failing the job."
          exit 1  # Exit with error if Zizmor finds issues
        fi
